#!/usr/bin/env node
const { serve } = require('../server/index');
const { run } = require('../puppeteer');
const url = require('url');

require('yargs') // eslint-disable-line
    .command('serve', 'start the server', (yargs) => {
        yargs
            .positional('root', {
                describe: 'test directory root',
                default: './test',
            })
            .number('port');
    }, (argv) => {
        serve({ port: argv.port });
        const p = url.resolve('/', argv.root.replace(/\\/g, '/'));
        console.log(`Visit http://127.0.0.1:${argv.port}${p} to run your tests`);
    })
    .command('run', 'run the tests', (yargs) => {
        yargs
            .positional('root', {
                describe: 'test directory root',
                default: './test',
            });
    }, (argv) => {
        const p = url.resolve('/', argv.root.replace(/\\/g, '/'));
        run({ root: p });
    })
    .argv;
